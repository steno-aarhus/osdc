---
title: "Algorithm"
output: rmarkdown::html_vignette
bibliography: references.bib
csl: vancouver.csl
vignette: >
  %\VignetteIndexEntry{Algorithm}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(osdc)
library(dplyr)
```

## `lpr_diag`

```{r, echo=FALSE}
algorithm |>
  filter(register == "lpr_diag") |>
  knitr::kable()
```

## `lpr_adm`

```{r, echo=FALSE}
algorithm |>
  filter(register == "lpr_adm") |>
  knitr::kable()
```

## `diagnoser`

-   `diagnosekode` starts with "DO0[0-6]", "DO8[0-4]", "DZ3[37]" or
    "DE1[0-4]".
    -   Is T1D if `diagnosekode` starts with "DE10".
    -   Is T2D if `diagnosekode` starts with "DE11".
-   `diagnosetype` is equal to either "A" or "B".
    -   Is a primary diagnosis if it equals "A".
-   `senere_afkraeftet` (if the diagnosis was later retracted) is equal
    to "Nej".

## `kontakter`

-   `hovedspeciale_ans` (hospital department) is categorized as
    "endocrinology" if it equals "medicinsk endokrinologi" or as "other
    medical" if it equals any of "Blandet medicin og kirurgi", "Intern
    medicin", "Geriatri", "Hepatologi", "Hæmatologi",
    "Infektionsmedicin", "Kardiologi", "Medicinsk allergologi",
    "Medicinsk gastroenterologi", "Medicinsk lungesygdomme",
    "Nefrologi", "Reumatologi", "Palliativ medicin", "Akut medicin",
    "Dermato-venerologi", "Neurologi", "Onkologi", "Fysiurgi", or
    "Tropemedicin".

## `lab_forsker`

```{r, echo=FALSE}
algorithm |>
  filter(name == "hba1c") |>
  knitr::kable()
```

## `ssyi` and `sssy`

-   `speciale` starts with "54".
-   `barnmark` (services provided to a child of the individual) is not
    equal to 0.

## `lmdb`

```{r, echo=FALSE}
algorithm |>
  filter(name == "gld") |>
  knitr::kable()
```

## `bef` and only GLD (via `lmdb`)

To remove those with potential polycystic ovary syndrome:

-   `atc` starts with "A10BA02" and `koen` is equal to 2 (woman) and
    (`date` minus `foed_dato` (birth date) is less than 40 or
    `indication_code` equals one of "0000092", "0000276" or "0000781")

## Pregnancy events

```{r, echo=FALSE}
algorithm |>
  filter(name == "exclude_pregnancy") |>
  knitr::kable()
```
A more complete description of the classifier is found in Anders Aasted
Isaksen's [PhD Thesis](https://aastedet.github.io/dissertation/) as well
as the validation paper [@Isaksen2023]. The description of the algorithm
below is a brief and concise version of those documents.

The overall output of this algorithm is first to classify those with
diabetes, then to further classify and check if the individuals might
have type 1 diabetes, otherwise classify as type 2 diabetes.

The initial **diabetes** classification is defined as the second
occurrence of any of the listed inclusion events. Wherever possible, all
available data for each event is used, except for the purchases of
glucose-lowering drugs, since the data on obstetric diagnoses necessary
to censor glucose-lowering drug purchases is only complete from 1997
onwards. Inclusion criteria are:

1.  HbA1c measurements of ≥48 mmol/mol.
2.  Hospital diagnoses of diabetes.
3.  Diabetes-specific services received at podiatrist.
4.  Purchase of glucose-lowering drugs.

Exclusions are:

1.  HbA1c samples:
    -   Samples taken during pregnancies, as that could be a potential
        gestational diabetes mellitus.
2.  Glucose-lowering drugs:
    -   Brand drugs for weight loss, e.g. *Saxenda*.
    -   Purchases during pregnancies, as that is a potential treatment
        for gestational diabetes mellitus.
    -   Metformin for women below age 40, as that could be a treatment
        for polycystic ovary syndrome.

### Classifying type 1 diabetes

Diabetes type is classified as either T1D or T2D based on patterns of
purchases of insulin drugs (including analogues) and hospital primary
diagnoses of T1D and T2D.

Classification as T1D requires an individual to fulfill either of the
following criteria:

a.  Must have purchased only insulin drugs and never any other type of
    glucose-lowering drugs, and have at least one diagnosis of T1D
b.  Must have a majority of T1D diagnoses from endocrinological
    departments (or from other medical departments, in the absence of
    contacts to endocrinological departments), and a purchase of insulin
    within 180 days after onset of diabetes, with insulin contributing
    at least two thirds of all defined daily doses of glucose-lowering
    drugs purchased.

In populations generated on a fixed index date (such as the
cross-sectional studies associated with this dissertation), individuals
classified as T1D cases must have purchased insulin drugs in the last
year prior to the index date.

### Classifying type 2 diabetes

Individuals not classified as T1D cases are classified as T2D cases.

## References
