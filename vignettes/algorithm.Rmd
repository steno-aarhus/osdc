---
title: "Algorithm"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Algorithm}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(osdc)
library(tidyverse)
```

## `lpr_diag`

```{r, echo=FALSE}
algorithm |>
  filter(str_detect(register, "lpr_diag") |>
  knitr::kable()
```

## `lpr_adm`

-   `c_spec` (hospital department) categorize as "endocrinology" if it
    equals 8 or as "other medical" if it is \< 8 or equals either 9 to
    30. 

## `diagnoser`

-   `diagnosekode` starts with "DO0[0-6]", "DO8[0-4]", "DZ3[37]" or
    "DE1[0-4]".
    -   Is T1D if `diagnosekode` starts with "DE10".
    -   Is T2D if `diagnosekode` starts with "DE11".
-   `diagnosetype` is equal to either "A" or "B".
    -   Is a primary diagnosis if it equals "A".
-   `senere_afkraeftet` (if the diagnosis was later retracted) is equal
    to "Nej".

## `kontakter`

-   `hovedspeciale_ans` (hospital department) is categorized as
    "endocrinology" if it equals "medicinsk endokrinologi" or as "other
    medical" if it equals any of "Blandet medicin og kirurgi", "Intern
    medicin", "Geriatri", "Hepatologi", "HÃ¦matologi",
    "Infektionsmedicin", "Kardiologi", "Medicinsk allergologi",
    "Medicinsk gastroenterologi", "Medicinsk lungesygdomme",
    "Nefrologi", "Reumatologi", "Palliativ medicin", "Akut medicin",
    "Dermato-venerologi", "Neurologi", "Onkologi", "Fysiurgi", or
    "Tropemedicin".

## `lab_forsker`

```{r, echo=FALSE}
algorithm |>
  filter(name == "hba1c") |>
  knitr::kable()
```

## `ssyi` and `sssy`

-   `speciale` starts with "54".
    -   Alternatively, use `spec2` if available.
-   `barnmark` (services provided to a child of the individual) is not
    equal to 0.

## `lmdb`

```{r, echo=FALSE}
algorithm |>
  filter(name == "gld") |>
  knitr::kable()
```

## `bef` and only GLD (via `lmdb`)

To remove those with potential polycystic ovary syndrome:

-   `atc` starts with "A10BA02" and `koen` is equal to 2 (woman) and
    (`date` minus `foed_dato` (birth date) is less than 40 or
    `indication_code` equals one of "0000092", "0000276" or "0000781")
