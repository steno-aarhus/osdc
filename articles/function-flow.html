<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Internal function flow • osdc</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Internal function flow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">osdc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/osdc.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/algorithm.html">Algorithm</a></li>
    <li><a class="dropdown-item" href="../articles/changes.html">Changes to algorithm</a></li>
    <li><a class="dropdown-item" href="../articles/data-sources.html">Data sources</a></li>
    <li><a class="dropdown-item" href="../articles/design.html">Design</a></li>
    <li><a class="dropdown-item" href="../articles/function-flow.html">Internal function flow</a></li>
    <li><a class="dropdown-item" href="../articles/rationale.html">Rationale</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/steno-aarhus/osdc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Internal function flow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/steno-aarhus/osdc/blob/main/vignettes/articles/function-flow.Rmd" class="external-link"><code>vignettes/articles/function-flow.Rmd</code></a></small>
      <div class="d-none name"><code>function-flow.Rmd</code></div>
    </div>

    
    
<p>The function flow describes the functions within the package, both
internal and user-facing, which data sources they rely on, and how they
are connected to each other. First, the functions for classifying
diabetes status are presented, followed by the functions for classifying
the diabetes type.</p>
<div class="section level2">
<h2 id="function-flow">Function flow<a class="anchor" aria-label="anchor" href="#function-flow"></a>
</h2>
<p>This results in the functionality flow for classifying diabetes
status seen below. This flow can be divided into two sections:
extracting the diabetes population and classifying diabetes type which
we will detail in the following sections.</p>
<div class="float">
<img src="images/function-flow.svg" alt="Flow of functions, as well as their required input registers, for classifying diabetes status using the osdc package. Light blue and orange boxes represent filtering functions (inclusion and exclusion events, respectively). Uncoloured boxes are helper functions that get or extract a condition or joins data or function outputs."><div class="figcaption">Flow of functions, as well as their required
input registers, for classifying diabetes status using the osdc package.
Light blue and orange boxes represent filtering functions (inclusion and
exclusion events, respectively). Uncoloured boxes are helper functions
that get or extract a condition or joins data or function outputs.</div>
</div>
</div>
<div class="section level2">
<h2 id="population-extraction">Population extraction<a class="anchor" aria-label="anchor" href="#population-extraction"></a>
</h2>
<p>In the following sections, we describe the functions used to extract
the diabetes population from the Danish registers. The functions are
divided into inclusion and exclusion events, and the final diagnosis
date is calculated based on these events.</p>
<div class="float">
<img src="images/function-flow-population.svg" alt="Flow of functions, as well as their required input registers, for extracting the population with diabetes using the osdc package. Light blue and orange boxes represent filtering functions (inclusion and exclusion events, respectively). Uncoloured boxes are helper functions that get or extract a condition or joins data or function outputs."><div class="figcaption">Flow of functions, as well as their required
input registers, for extracting the population with diabetes using the
osdc package. Light blue and orange boxes represent filtering functions
(inclusion and exclusion events, respectively). Uncoloured boxes are
helper functions that get or extract a condition or joins data or
function outputs.</div>
</div>
<div class="section level3">
<h3 id="inclusion-events">Inclusion events<a class="anchor" aria-label="anchor" href="#inclusion-events"></a>
</h3>
<div class="section level4">
<h4 id="hba1c-tests-above-the-diagnosis-cut-off-value-48-mmolmol-or-6-5">HbA1c tests above the diagnosis cut-off value (48 mmol/mol or
6.5%)<a class="anchor" aria-label="anchor" href="#hba1c-tests-above-the-diagnosis-cut-off-value-48-mmolmol-or-6-5"></a>
</h4>
<p>The function <code><a href="../reference/include_hba1c.html">include_hba1c()</a></code> uses
<code>lab_forsker</code> as the input data to extract all events of
HbA1c tests above the diagnosis cut-off value.</p>
<p>Since the HbA1c diagnosis cut-off value depends on the kind of test
that is used, the inclusion event is defined as follows:</p>
<ul>
<li>For HbA1c IFCC (NPU03835), we include values &gt;= 6.5 %.</li>
<li>For HbA1c DCCT (NPU27300), we include values &gt;= 48 mmol/mol.</li>
</ul>
<table class="table">
<caption>Algorithm used in the implementation for including
HbA1c.</caption>
<colgroup>
<col width="6%">
<col width="94%">
</colgroup>
<thead><tr class="header">
<th align="left">name</th>
<th align="left">logic</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">hba1c</td>
<td align="left">(analysiscode == ‘NPU27300’ AND value &gt;= 48) OR
(analysiscode == ‘NPU03835’ AND value &gt;= 6.5)</td>
</tr></tbody>
</table>
</div>
<div class="section level4">
<h4 id="hospital-diagnosis-of-diabetes">Hospital diagnosis of diabetes<a class="anchor" aria-label="anchor" href="#hospital-diagnosis-of-diabetes"></a>
</h4>
<p>The function <code>include_diabetes_diagnoses()</code> uses the
hospital contacts from LPR2 and 3 to include all dates of diabetes
diagnoses. Diabetes diagnoses from both ICD 8 and ICD 10 are
included.</p>
<p>This function contains two helper functions:</p>
<ul>
<li><code>keep_diabetes_icd10()</code></li>
<li><code>keep_diabetes_icd8()</code></li>
</ul>
<!-- TODO: Add details on how this filtering should be done, e.g., diagnosis codes --><!-- TODO: Which specific ICD 8 and 10 codes are included? -->
</div>
<div class="section level4">
<h4 id="diabetes-specific-podiatrist-services">Diabetes-specific podiatrist services<a class="anchor" aria-label="anchor" href="#diabetes-specific-podiatrist-services"></a>
</h4>
<p>The function <code>include_podiatrist_services()</code> uses
<code>sysi</code> or <code>sssy</code> as input to extract the dates of
all diabetes-specific podiatrist services.</p>
<!-- TODO: Add details on how this filtering should be done -->
</div>
<div class="section level4">
<h4 id="gld-purchases">GLD purchases<a class="anchor" aria-label="anchor" href="#gld-purchases"></a>
</h4>
<p>The function <code><a href="../reference/include_gld_purchases.html">include_gld_purchases()</a></code> uses
<code>lmdb</code> to extract the dates of all GLD purchases (from 1997
onwards).</p>
<!-- TODO: Add details on how this filtering should be done -->
<!-- TODO: Add this + link to resource "For details about this, see [link]." -->
</div>
</div>
<div class="section level3">
<h3 id="exclusion-events">Exclusion events<a class="anchor" aria-label="anchor" href="#exclusion-events"></a>
</h3>
<div class="section level4">
<h4 id="hba1c-tests-and-gld-purchases-during-pregnancy">HbA1c tests and GLD purchases during pregnancy<a class="anchor" aria-label="anchor" href="#hba1c-tests-and-gld-purchases-during-pregnancy"></a>
</h4>
<p>The function <code>exclude_pregnancy()</code> uses diagnoses from
LPR2 or LPR3 as input and is used to exclude both HbA1c tests and GLD
purchases during pregnancy.</p>
<p>Internally, this relies on the function
<code>get_pregnancy_dates()</code> that contains the following three
helper functions:</p>
<ul>
<li>
<code>calculate_pregnancy_index_date_for_mc_visits_wo_end_date()</code>
(this might be removed with the inclusion of the birth register)</li>
<li>
<code>get_pregnancy_end_dates()</code>: Keep maternal care visits
with an end date and drop visits between 40 weeks before end date and 12
weeks after end date.</li>
<li>
<code>get_maternal_care_visit_dates_without_end_date()</code>: Uses
the output from <code>get_pregnancy_end_dates()</code> which identifies
maternal care visits <em>with</em> end dates to derive maternal care
visits <em>without</em> end dates. below.</li>
</ul>
<!-- TODO: What is done with the mc visits without end dates then? --><!-- TODO: Add details on how this filtering should be done -->
</div>
<div class="section level4">
<h4 id="glucose-lowering-brand-drugs-for-weight-loss">Glucose-lowering brand drugs for weight loss<a class="anchor" aria-label="anchor" href="#glucose-lowering-brand-drugs-for-weight-loss"></a>
</h4>
<p>The function <code>exclude_wld_purchases()</code> uses lmdb as input
and excludes the brand drugs Saxenda and Wegovy.</p>
<!-- TODO: Add details on how this filtering should be done -->
</div>
<div class="section level4">
<h4 id="metformin-purchases-for-women-below-age-40">Metformin purchases for women below age 40<a class="anchor" aria-label="anchor" href="#metformin-purchases-for-women-below-age-40"></a>
</h4>
<p>The function <code>exclude_potential_pcos()</code> as input to
exclude all purchases of metformin by women below age 40 (i.e., &lt;= 39
years old) at the date of purchase. It relies on <code>bef</code> as
input.</p>
<p>This function contains two helper functions:</p>
<ul>
<li><code>keep_women()</code></li>
<li><code>drop_age_40_below()</code></li>
</ul>
<!-- TODO: Add details on how this filtering should be done -->
</div>
</div>
<div class="section level3">
<h3 id="get-diagnosis-date">Get diagnosis date<a class="anchor" aria-label="anchor" href="#get-diagnosis-date"></a>
</h3>
<p>The function <code>get_diagnosis_date()</code> combines the outputs
from the inclusion and exclusion functions to get the final diagnosis
date. Initially, it drops the first inclusion and exclusion events from
the function outputs with the helper <code>drop_first_event()</code>, so
that only those with two or more events are kept. This is then used to
assign an initial diagnosis according to OSDC. Then, all the outputs are
joined together with <code>join_diagnosis_dates()</code>.</p>
<p>Finally, the dates outside of the data coverage period are dropped
with <code>drop_diagnosis_dates_outside_coverage()</code> to end with a
final diagnosis date. For details on this censoring based on periods
with insufficient data coverage, see the
<code><a href="../articles/design.html">vignette("design")</a></code>.</p>
</div>
<div class="section level3">
<h3 id="classifying-the-diabetes-type">Classifying the diabetes type<a class="anchor" aria-label="anchor" href="#classifying-the-diabetes-type"></a>
</h3>
<p>The next step of the OSDC algorithm classifies individuals from the
extracted diabetes population as having either T1D or T2D. As described
in the <code><a href="../articles/design.html">vignette("design")</a></code>, individuals not classified as
T1D cases are classified as T2D cases.</p>
<p>The output is a <code>data.frame</code> that includes one row per
individual in the diabetes population: one column with their PNR, two
columns with inclusion dates (one “stable” date and one “raw” date - see
the <code><a href="../articles/design.html">vignette("design")</a></code> for an elaboration on what that
entails), and one column with the diabetes type.</p>
<!-- TODO: add a link to the specific section where this is described -->
<div class="float">
<img src="images/function-flow-classification.svg" alt="Flow of functions for classifying diabetes status using the osdc package."><div class="figcaption">Flow of functions for classifying diabetes
status using the <code>osdc</code> package.</div>
</div>
<div class="section level4">
<h4 id="type-1-classification">Type 1 classification<a class="anchor" aria-label="anchor" href="#type-1-classification"></a>
</h4>
<p>The details for the classification of type 1 diabetes is described in
<code><a href="../articles/design.html">vignette("design")</a></code>. To classify whether an individual has
T1D, the OSDC algorithm includes the following criteria:</p>
<ol style="list-style-type: decimal">
<li>
<code>get_t1d_primary_diagnosis()</code>, which relies on the
hospital diagnoses extracted from <code>lpr_diag</code> (LPR2) and
<code>diagnoser</code> (LPR3) in the previous steps.</li>
<li>
<code>get_only_insulin_purchases()</code> which relies on the GLD
purchases from Lægemiddelsdatabasen to get patients where all GLD
purchases are insulin only.</li>
<li>
<code>get_majority_of_t1d_diagnoses()</code> (as compared to T2D
diagnoses) which again relies on primary hospital diagnoses from
LPR.</li>
<li>
<code>get_insulin_purchase_within_180_days()</code> which relies on
both diagnosis from LPR and GLD purchases from
Lægemiddelsdatabasen.</li>
<li>
<code>get_insulin_is_two_thirds_of_gld_doses</code> which relies on
the GLD purchases from Lægemiddelsdatabasen.</li>
</ol>
<p>Note the following hierarchy in first function above: First, the
function checks whether the individual has primary diagnoses from
endocrinological specialty. If that’s the case for a given person, the
check of whether they have a majority of T1D primary diagnoses are based
on data from endocrinological specialty. If that’s not the case, the
check will be based on primary diagnoses from medical specialties.</p>
</div>
<div class="section level4">
<h4 id="type-2-classification">Type 2 classification<a class="anchor" aria-label="anchor" href="#type-2-classification"></a>
</h4>
<p>As described in the <code><a href="../articles/design.html">vignette("design")</a></code>, individuals not
classified as type 1 cases are classified as type 2 cases.</p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Luke William Johnston, Signe Kirk Brødbæk, Anders Aasted Isaksen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
